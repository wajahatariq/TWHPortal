<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Billing Portal</title>
    <link rel="icon" type="image/png" href="/static/img/Logo White.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/static/css/style.css">
    <script>window.PAGE_TYPE = 'billing';</script>
</head>
<body class="py-10">
    <div id="toast-root" class="toast-container"></div>

    <div class="max-w-4xl mx-auto glass-panel p-8 rounded-2xl shadow-2xl relative">
        
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-white drop-shadow-md">Billing Submission</h1>
            
            <div class="flex items-center gap-4">
                <a href="/" class="text-sm text-[#ffb3b3] hover:text-white">‚Üê Back Home</a>
                
                <div class="notification-container">
                    <button class="notif-btn" onclick="toggleNotifDropdown()">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-[#ffb3b3]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                        </svg>
                        <span id="notif-badge" class="notif-badge hidden">0</span>
                    </button>
                    <div id="notif-dropdown" class="notif-dropdown custom-scrollbar">
                        <div class="p-3 text-xs font-bold text-[#6E1A2D] bg-[#2d050a] border-b border-[#6E1A2D]/30 uppercase tracking-wider">Recent Alerts</div>
                        <div id="notif-list-body">
                            <div class="p-4 text-center text-sm text-gray-500 italic">No new notifications</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <form id="billingForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <input type="hidden" name="type" value="billing">
            
            <div class="col-span-full bg-[#4a0e16]/50 p-4 rounded-xl border border-[#6E1A2D]/30">
                <label class="block text-sm font-bold text-[#ffb3b3] mb-2 uppercase">Agent Info</label>
                <select name="agent" class="input-field" required>
                    <option value="">Select Agent...</option>
                    {% for agent in agents %}<option value="{{ agent }}">{{ agent }}</option>{% endfor %}
                </select>
            </div>

            <div><label class="block text-sm font-medium mb-1">Client Name</label><input type="text" name="client_name" required class="input-field"></div>
            <div><label class="block text-sm font-medium mb-1">Phone Number</label><input type="text" name="phone" required class="input-field"></div>
            
            <div class="col-span-full"><label class="block text-sm font-medium mb-1">Address</label><input type="text" name="address" required class="input-field"></div>
            <div class="col-span-full"><label class="block text-sm font-medium mb-1">Email</label><input type="email" name="email" required class="input-field"></div>

            <div class="col-span-full bg-[#4a0e16]/50 p-4 rounded-xl border border-[#6E1A2D]/30 mt-2">
                <label class="block text-sm font-bold text-[#ffb3b3] mb-4 uppercase">Payment Details</label>
                <div class="grid grid-cols-2 gap-4">
                    <div class="col-span-2"><input type="text" name="card_holder" placeholder="Card Holder Name" required class="input-field"></div>
                    <div class="col-span-2"><input type="text" name="card_number" placeholder="Card Number" required class="input-field"></div>
                    <div><input type="text" name="exp_date" placeholder="MM/YY" required class="input-field"></div>
                    <div><input type="text" name="cvc" placeholder="CVC" required class="input-field"></div>
                    <div class="col-span-2"><input type="text" name="charge_amt" placeholder="Charge Amount ($)" required class="input-field text-green-400 font-bold"></div>
                </div>
            </div>

            <div><label class="block text-sm font-medium mb-1">LLC Name</label>
                <select name="llc" class="input-field">
                    {% for llc in llcs %}<option value="{{ llc }}">{{ llc }}</option>{% endfor %}
                </select>
            </div>
            <div><label class="block text-sm font-medium mb-1">Provider</label>
                <select name="provider" class="input-field">
                    {% for p in providers %}<option value="{{ p }}">{{ p }}</option>{% endfor %}
                </select>
            </div>

            <div><label class="block text-sm font-medium mb-1">Pin Code (Optional)</label><input type="text" name="pin_code" class="input-field"></div>
            <div><label class="block text-sm font-medium mb-1">Account Number (Optional)</label><input type="text" name="account_number" class="input-field"></div>

            <div class="col-span-full mt-6">
                <button type="submit" id="submitBtn" class="w-full bg-[#8B2339] hover:bg-[#a62b44] text-white font-bold py-4 rounded-xl transition shadow-lg text-lg">Submit Order</button>
            </div>
        </form>
    </div>
    
    <script src="https://js.pusher.com/8.4.0/pusher.min.js"></script>
    <script>
        window.PUSHER_KEY = "{{ pusher_key }}";
        window.PUSHER_CLUSTER = "{{ pusher_cluster }}";
        
        document.getElementById('billingForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            btn.innerText = "Processing...";
            btn.disabled = true;
            
            const fd = new FormData(e.target);
            const res = await fetch('/api/save-lead', { method: 'POST', body: fd });
            const data = await res.json();
            
            if(data.status === 'success') {
                alert('Order Submitted Successfully!');
                e.target.reset();
            } else {
                alert('Error: ' + data.message);
            }
            btn.innerText = "Submit Order";
            btn.disabled = false;
        });
    </script>
    <script src="/static/js/main.js"></script>
</body>
</html>
