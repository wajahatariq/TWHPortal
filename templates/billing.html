<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TWH - Billing Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://js.pusher.com/7.0/pusher.min.js"></script>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body class="bg-slate-900 text-white min-h-screen p-6">

    <div class="max-w-4xl mx-auto">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold tracking-tight text-blue-500">Billing Portal</h1>
            <div class="flex gap-4">
                <input type="text" id="searchId" placeholder="Search Order ID..." class="px-4 py-2 rounded bg-slate-800 border border-slate-700 focus:border-blue-500 outline-none">
                <button onclick="searchLead()" class="bg-blue-600 hover:bg-blue-500 px-4 py-2 rounded font-bold transition">Find</button>
            </div>
        </div>

        <div id="editOptions" class="hidden mb-6 p-4 bg-yellow-900/30 border border-yellow-600 rounded flex justify-between items-center">
            <span class="text-yellow-500 font-bold">⚠️ Edit Mode Active</span>
            <button onclick="location.reload()" class="text-sm bg-slate-700 px-3 py-1 rounded hover:bg-slate-600">Cancel Edit</button>
        </div>

        <form id="billingForm" class="bg-slate-800 p-8 rounded-2xl shadow-2xl border border-slate-700 space-y-6">
            
            <input type="hidden" name="is_edit" id="isEdit" value="false">
            <input type="hidden" name="timestamp_mode" value="keep">
            <input type="hidden" name="original_timestamp" id="original_timestamp">
            <input type="hidden" name="row_index" id="row_index">

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-slate-400 text-sm mb-1">Agent Name</label>
                    <input type="text" name="agent" id="agent" required class="w-full bg-slate-900 border border-slate-700 rounded p-3 focus:border-blue-500 outline-none">
                </div>
                <div>
                    <label class="block text-slate-400 text-sm mb-1">Client Name</label>
                    <input type="text" name="client_name" id="client_name" required class="w-full bg-slate-900 border border-slate-700 rounded p-3 focus:border-blue-500 outline-none">
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-slate-400 text-sm mb-1">Phone Number</label>
                    <input type="text" name="phone" id="phone" required class="w-full bg-slate-900 border border-slate-700 rounded p-3 focus:border-blue-500 outline-none">
                </div>
                <div>
                    <label class="block text-slate-400 text-sm mb-1">Email</label>
                    <input type="email" name="email" id="email" required class="w-full bg-slate-900 border border-slate-700 rounded p-3 focus:border-blue-500 outline-none">
                </div>
            </div>

            <div>
                <label class="block text-slate-400 text-sm mb-1">Billing Address</label>
                <input type="text" name="address" id="address" required class="w-full bg-slate-900 border border-slate-700 rounded p-3 focus:border-blue-500 outline-none">
            </div>

            <hr class="border-slate-700">

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-slate-400 text-sm mb-1">Card Holder Name</label>
                    <input type="text" name="card_holder" id="card_holder" required class="w-full bg-slate-900 border border-slate-700 rounded p-3 focus:border-blue-500 outline-none">
                </div>
                <div>
                    <label class="block text-slate-400 text-sm mb-1">Card Number</label>
                    <input type="text" name="card_number" id="card_number" required class="w-full bg-slate-900 border border-slate-700 rounded p-3 focus:border-blue-500 outline-none">
                </div>
                <div>
                    <label class="block text-slate-400 text-sm mb-1">Expiry Date (MM/YY)</label>
                    <input type="text" name="exp_date" id="exp_date" required class="w-full bg-slate-900 border border-slate-700 rounded p-3 focus:border-blue-500 outline-none">
                </div>
                <div>
                    <label class="block text-slate-400 text-sm mb-1">CVC</label>
                    <input type="text" name="cvc" id="cvc" required class="w-full bg-slate-900 border border-slate-700 rounded p-3 focus:border-blue-500 outline-none">
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-slate-400 text-sm mb-1">Charge Amount</label>
                    <input type="text" name="charge_amt" id="charge_amt" placeholder="$0.00" required class="w-full bg-slate-900 border border-slate-700 rounded p-3 focus:border-blue-500 outline-none">
                </div>
                <div>
                    <label class="block text-slate-400 text-sm mb-1">LLC Name</label>
                    <select name="llc" id="llc" class="w-full bg-slate-900 border border-slate-700 rounded p-3 focus:border-blue-500 outline-none">
                        <option value="Visionary Pathways">Visionary Pathways</option>
                        <option value="Techware Hub">Techware Hub</option>
                    </select>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <label class="block text-slate-400 text-sm mb-1">Order ID</label>
                    <input type="number" name="order_id" id="order_id" required class="w-full bg-slate-900 border border-slate-700 rounded p-3 focus:border-blue-500 outline-none">
                </div>
                <div>
                    <label class="block text-slate-400 text-sm mb-1">Provider</label>
                    <select name="provider" id="providerSelect" onchange="toggleProviderFields()" class="w-full bg-slate-900 border border-slate-700 rounded p-3 focus:border-blue-500 outline-none">
                        <option value="">Select Provider</option>
                        <option value="Spectrum">Spectrum</option>
                        <option value="Xfinity">Xfinity</option>
                        <option value="AT&T">AT&T</option>
                        <option value="Cox">Cox</option>
                        <option value="DirectTV">DirectTV</option>
                        <option value="Optimum">Optimum</option>
                        <option value="T-Mobile">T-Mobile</option>
                        <option value="Verizon">Verizon</option>
                    </select>
                </div>
                
                <div id="pinGroup" class="hidden">
                    <label class="block text-slate-400 text-sm mb-1">PIN Code</label>
                    <input type="text" name="pin_code" id="pin_code" class="w-full bg-slate-900 border border-slate-700 rounded p-3 focus:border-blue-500 outline-none">
                </div>
                <div id="accountGroup" class="hidden">
                    <label class="block text-slate-400 text-sm mb-1">Account Number</label>
                    <input type="text" name="account_number" id="account_number" class="w-full bg-slate-900 border border-slate-700 rounded p-3 focus:border-blue-500 outline-none">
                </div>
            </div>

            <button type="submit" id="submitBtn" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 rounded-xl shadow-lg shadow-blue-900/20 transition transform active:scale-95">
                Submit Lead
            </button>
        </form>
    </div>

    <div id="duplicateModal" class="fixed inset-0 bg-black/80 hidden items-center justify-center z-50">
        <div class="bg-slate-800 p-6 rounded-lg w-full max-w-md border border-slate-600">
            <h3 class="text-xl font-bold mb-4 text-white">Multiple Records Found</h3>
            <div id="duplicateList" class="space-y-2 max-h-60 overflow-y-auto pr-2">
                </div>
            <button onclick="document.getElementById('duplicateModal').classList.add('hidden')" class="mt-4 w-full bg-slate-700 py-2 rounded text-slate-300 hover:bg-slate-600">Cancel</button>
        </div>
    </div>

    <div id="emailModal" class="fixed inset-0 bg-slate-900/90 hidden items-center justify-center z-50 backdrop-blur-sm transition-opacity">
        <div class="bg-slate-800 border border-slate-600 rounded-xl w-full max-w-2xl p-6 shadow-2xl relative">
            <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                <span class="text-green-400">✅</span> Payment Approved!
            </h3>
            <p id="emailSubtitle" class="text-slate-400 text-sm mb-3">Copy this email and send it to the client.</p>
            
            <textarea id="emailContent" class="w-full h-64 bg-slate-900 text-slate-200 border border-slate-700 rounded-lg p-4 font-mono text-sm leading-relaxed focus:ring-2 focus:ring-blue-500 outline-none resize-none" readonly></textarea>
            
            <div class="flex justify-end gap-3 mt-6">
                <button onclick="closeEmailModal()" class="px-4 py-2 rounded-lg text-slate-300 hover:text-white hover:bg-slate-700 transition">Close</button>
                <button onclick="copyEmailText()" class="px-6 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg font-bold shadow-lg shadow-blue-500/30 transition flex items-center gap-2">
                    Copy to Clipboard
                </button>
            </div>
        </div>
    </div>
    
    <audio id="notifSound" src="/static/sounds/new_lead.mp3" preload="auto"></audio>

    <script src="/static/js/billing.js"></script>
</body>
</html>
